package com.healthcare.service;

import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

import org.modelmapper.ModelMapper;
import org.springframework.stereotype.Service;

import com.healthcare.dto.FoodieDetailsDto;
import com.healthcare.entities.Foodie;
import com.healthcare.exception_handler.InvalidDetailsException;
import com.healthcare.exception_handler.NoContentException;
import com.healthcare.exception_handler.ResourceNotFoundException;
import com.healthcare.repository.FoodieRepo;

import lombok.AllArgsConstructor;

@Service
@AllArgsConstructor
public class FoodieServiceImpl implements FoodieService {
	
	// dependencies
	private final FoodieRepo repo;
	private final ModelMapper mapper;

	@Override
	public void updateFoodie(Foodie changedFoodie){
		Foodie f = repo.save(changedFoodie);
		
		if(f==null){
			throw new InvalidDetailsException("Invalid Foodie credentials");
		}
	}
	
	@Override
	public void addFoodie(Foodie newFoodie){
		Foodie f = repo.save(newFoodie);
		
		if(f==null){
			throw new InvalidDetailsException("Invalid Foodie credentials");
		}
	}

	@Override
	public Foodie findById(Long id) {
		Optional<Foodie> f = repo.findById(id);
		if(f.isPresent()) {
			return f.get();
		}
		throw new ResourceNotFoundException("Foodie Id doesn't exist");
	}
	
	@Override
	public Foodie findByIdWithCreators(Long foodie_id){
		Optional<Foodie> f = repo.findByIdWithCreators(foodie_id);
		if(f.isPresent()) {
			return f.get();
		}
		throw new ResourceNotFoundException("Foodie Id doesn't exist");
	}
	

	


	@Override
	public List<FoodieDetailsDto> findAll() {
		List<Foodie> f = repo.findAll();
		if(!(f.isEmpty())) {
			return f.stream()
			        .map(m -> {
			        	Long fid = m.getF_id();
			        	FoodieDetailsDto mappedToDto = mapper.map(m.getUserId(), FoodieDetailsDto.class);
			        	mappedToDto.setF_id(fid);
			        	return mappedToDto;
			        })
			        .collect(Collectors.toList());
		}
		throw new NoContentException("No such foodie exists");
	}
}
